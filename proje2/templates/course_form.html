<!--
===============================================================================
Ders Ekleme/DÃ¼zenleme Formu Template'i
Bu sayfa yeni ders ekleme ve mevcut dersleri dÃ¼zenleme iÃ§in kullanÄ±lÄ±r.
Ã–zellikler: Dropdown Ã¶ÄŸretim Ã¼yesi seÃ§imi, dinamik form, validation
===============================================================================
-->
{% extends "base.html" %}

{% block content %}
<div class="card-like">
  <h2 class="text-primary-green mb-4">
    {% if course %}ğŸ“ Ders DÃ¼zenle{% else %}â• Yeni Ders Ekle{% endif %}
  </h2>
<!-- Ders bilgileri formu -->
<form method="post" class="row g-3"></form>
  <div class="col-md-6">
    <label class="form-label">ğŸ“š Ders AdÄ±</label>
    <input
      type="text"
      name="name"
      class="form-control"
      placeholder="Ã–rn: Matematik I, Fizik II"
      value="{{ course.name if course else '' }}"
      required
    />
  </div>
  <div class="col-md-3">
    <label class="form-label">ğŸ›ï¸ FakÃ¼lte</label>
    <input
      type="text"
      name="faculty"
      class="form-control"
      placeholder="Ã–rn: MÃ¼hendislik FakÃ¼ltesi"
      value="{{ course.faculty if course else '' }}"
      required
    />
  </div>
  <div class="col-md-3">
    <label class="form-label">ğŸ“ BÃ¶lÃ¼m</label>
    <input
      type="text"
      name="department"
      class="form-control"
      placeholder="Ã–rn: Bilgisayar MÃ¼hendisliÄŸi"
      value="{{ course.department if course else '' }}"
      required
    />
  </div>
  <div class="col-md-4">
    <label class="form-label">ğŸ‘¨â€ğŸ« Ã–ÄŸretim Ãœyesi</label>
    <!-- Ã–ÄŸretim Ã¼yesi seÃ§imi - Dropdown veya yeni ekleme -->
    <div class="input-group">
      <select name="instructor" class="form-select" id="instructorSelect" required>
        <option value="">Ã–ÄŸretim Ã¼yesi seÃ§in...</option>
        {% for instructor in instructors %}
        <option value="{{ instructor }}" 
                {% if course and course.instructor == instructor %}selected{% endif %}>
          {{ instructor }}
        </option>
        {% endfor %}
        <option value="new">â• Yeni Ã¶ÄŸretim Ã¼yesi ekle</option>
      </select>
    </div>
    <!-- Yeni Ã¶ÄŸretim Ã¼yesi iÃ§in gizli input alanÄ± -->
    <input
      type="text"
      id="newInstructorInput"
      class="form-control mt-2"
      placeholder="Yeni Ã¶ÄŸretim Ã¼yesi adÄ±"
      style="display: none;"
    />
  </div>
  <div class="col-md-4">
    <label class="form-label">ğŸ‘¥ Ã–ÄŸrenci SayÄ±sÄ±</label>
    <input
      type="number"
      name="student_count"
      class="form-control"
      min="1"
      placeholder="Ã–rn: 150"
      value="{{ course.student_count if course else '' }}"
      required
    />
  </div>
  <div class="col-md-4">
    <label class="form-label">â±ï¸ SÄ±nav SÃ¼resi (dk)</label>
    <select name="exam_duration" class="form-select" required>
      {% set cur_dur = course.exam_duration if course else None %}
      <option value="30" {% if cur_dur == 30 %}selected{% endif %}>30</option>
      <option value="60" {% if cur_dur == 60 %}selected{% endif %}>60</option>
      <option value="90" {% if cur_dur == 90 %}selected{% endif %}>90</option>
      <option value="120" {% if cur_dur == 120 %}selected{% endif %}>120</option>
    </select>
  </div>
  <div class="col-md-4">
    <label class="form-label">ğŸ“ SÄ±nav TÃ¼rÃ¼</label>
    <select name="exam_type" class="form-select" required>
      {% set cur_type = course.exam_type if course else None %}
      <option value="vize" {% if cur_type == 'vize' %}selected{% endif %}>Vize</option>
      <option value="final" {% if cur_type == 'final' %}selected{% endif %}>Final</option>
    </select>
  </div>
  <!-- SÄ±nav varlÄ±ÄŸÄ± checkbox'Ä± -->
  <div class="col-md-4 d-flex align-items-center">
    <div class="form-check mt-4">
      <input
        class="form-check-input"
        type="checkbox"
        name="has_exam"
        id="has_exam"
        {% if not course or course.has_exam %}checked{% endif %}
      />
      <label class="form-check-label" for="has_exam">Bu derste sÄ±nav var</label>
    </div>
  </div>
  <div class="col-md-4">
    <label class="form-label">âš ï¸ Ã–zel Durum (opsiyonel)</label>
    <input
      type="text"
      name="special_case"
      class="form-control"
      placeholder="Ã–rn: Laboratuvar gerekli"
      value="{{ course.special_case if course else '' }}"
    />
  </div>
  <!-- Form butonlarÄ± - Geri dÃ¶n ve kaydet -->
  <div class="col-12 d-flex justify-content-between">
    <a href="{{ url_for('main.list_courses') }}" class="btn btn-outline-secondary">
      â† Geri DÃ¶n
    </a>
    <button type="submit" class="btn btn-success">
      {% if course %}ğŸ’¾ GÃ¼ncelle{% else %}âœ… Kaydet{% endif %}
    </button>
  </div>
</form>
</div>
{% endblock %}

<!-- JavaScript - Dinamik Ã¶ÄŸretim Ã¼yesi seÃ§imi -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const instructorSelect = document.getElementById('instructorSelect');
    const newInstructorInput = document.getElementById('newInstructorInput');
    
    // Dropdown deÄŸiÅŸiklik olayÄ±nÄ± dinle
    instructorSelect.addEventListener('change', function() {
        if (this.value === 'new') {
            // Yeni Ã¶ÄŸretim Ã¼yesi seÃ§ildi - input alanÄ±nÄ± gÃ¶ster
            newInstructorInput.style.display = 'block';
            newInstructorInput.required = true;
            newInstructorInput.focus();
            
            // Dropdown'Ä± gizle
            this.style.display = 'none';
            this.required = false;
            
            // Input'un name Ã¶zelliÄŸini instructor yap
            newInstructorInput.name = 'instructor';
        }
    });
    
    // Yeni input alanÄ±na yazÄ± yazÄ±ldÄ±ÄŸÄ±nda geri dÃ¶nÃ¼ÅŸ butonu ekle
    newInstructorInput.addEventListener('input', function() {
        if (!document.getElementById('backToSelect')) {
            const backButton = document.createElement('button');
            backButton.type = 'button';
            backButton.className = 'btn btn-outline-secondary btn-sm mt-1';
            backButton.id = 'backToSelect';
            backButton.innerHTML = 'â†©ï¸ Listeden seÃ§';
            backButton.onclick = function() {
                // Dropdown'a geri dÃ¶n
                instructorSelect.style.display = 'block';
                instructorSelect.required = true;
                instructorSelect.value = '';
                
                // Input alanÄ±nÄ± gizle ve temizle
                newInstructorInput.style.display = 'none';
                newInstructorInput.required = false;
                newInstructorInput.value = '';
                newInstructorInput.name = '';
                
                // Geri dÃ¶nÃ¼ÅŸ butonunu kaldÄ±r
                this.remove();
            };
            newInstructorInput.parentNode.appendChild(backButton);
        }
    });
});
</script>


